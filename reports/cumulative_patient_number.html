<html>
	<head>
		<title>Cumulative number of patients</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Patients Enrolled in Period</title>
		<link href="../CSS/style.css" type="text/css" rel="stylesheet"/>
		<link href="../CSS/offline_css.css" type="text/css" rel="stylesheet"/>
		<script type="text/javascript" src="../Scripts/jquery.js"></script>
		<script type="text/javascript" src="../Scripts/offline_database.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				initDatabase();
				var $_GET = getQueryParams(document.location.search);
				var date = $_GET['date'];
				$("#date_of_appointment").text(date);
				selectEnvironmentVariables(function(transaction, results) {
					// Handle the results
					var row = results.rows.item(0);
					$("#facility_name").text(row['facility_name']);
				});
				
				getCumulativePatientNumber(date,function(transaction, results){ 			
					for(var i = 0; i < results.rows.length; i++) {				
						var parent_row = results.rows.item(i);	
						 var row_string="<tr><td>"+parent_row['name']+"</td>";
							row_string+="<td>"+parent_row['total']+"</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td>";
							row_string+="<td>0</td></tr>";
							
							$("#table_listing").append($(row_string));
					}	
		  		});
				
				/*var current_status=new Array('Active','Deceased','PEP end','PMTCT end','Lost to follow','Transfer out','Discharged','Transfer out')
				for (var i=0; i < current_status.length; i++) {
				  var row_string="<tr><td>"+current_status[i]+"</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td>";
						row_string+="<td>0</td></tr>";
						
						$("#table_listing").append($(row_string));
				};*/
			});	
			function getQueryParams(qs) {
				qs = qs.split("+").join(" ");
				var params = {}, tokens, re = /[?&]?([^=]+)=([^&]*)/g;
				while( tokens = re.exec(qs)) {
					params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
				}
				return params;
			}

			function getAge(dateString) {
				var today = new Date();
				var birthDate = new Date(dateString);
				var age = today.getFullYear() - birthDate.getFullYear();
				var m = today.getMonth() - birthDate.getMonth();
				if(m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
					age--;
				}
				if(isNaN(age)) {
					return "N/A";
				}
				return age;
			}
		</script>
	</head>
	<body>
		<style>
			#patient_listing {
				margin: 0 auto;
				border-top: 1px solid #B9B9B9;
				font-size: 12px;
				letter-spacing: 1px;
			}
			#patient_listing td th {
				padding: 10px;
			}
			#result_values {
				border: 1px solid black;
				width: 900px;
				margin: 0 auto;
				overflow: hidden;
				margin-bottom:20px;
			}
			
			.category_title {
				font-weight: bold;
				color: #003366;
				text-align: center;
				text-decoration: underline;
				font-size: 16px;
				letter-spacing: 2px;
			}
			.category {
				width: 49%;
				height: 100px;
				float: left;
			}
			.sub_category {
				width: 49%;
				height: 100px;
				float: left;
			}
			table {
				margin: 0 auto;
			}
			td{
				width: 60px;
				text-align: left;
			}
			th{
				text-decoration:underline;
			}
		</style>
		<h3 id="facility_name" style="text-align: center"></h3>
		<h4 style="text-align: center">Cumulative number of patients by current status  <span id="date_of_appointment"></span> </h4>
		<div id="result_values">
			<table id="table_listing">
				<tr>
					<th colspan="3"></th>
					<th colspan="7">Adults</th>
					<th colspan="8">Children</th>
				</tr>
				<tr>
					<th colspan="3"></th>
					<th colspan="3">Male</th>
					<th colspan="4">Female</th>
					<th colspan="4">Male</th>
					<th colspan="4">Female</th>
				</tr>
				<tr>
					<th>Current status</th>
					<th colspan="2">Total</th>
					<th>ART</th>
					<th>IO</th>
					<th>PEP</th>
					<th>ART</th>
					<th>PEP</th>
					<th>PMTCT</th>
					<th>IO</th>
					<th>ART</th>
					<th>PEP</th>
					<th>PMTCT</th>
					<th>IO</th>
					<th>ART</th>
					<th>PEP</th>
					<th>PMTCT</th>
					<th>IO</th>
				</tr>
				<tr>
					<th></th>
					<th>N</th>
					<th>%</th>
					<th colspan="15"></th>	
				</tr>
				<tr></tr>
			</table>
		</div>
	</body>
</html>